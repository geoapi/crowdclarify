'use strict';

var _toConsumableArray = require('babel-runtime/helpers/to-consumable-array')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = applyUpdate;

var _array_proxy = require('./array_proxy');

/**
 * Given a record and an update object, apply the update on the record. Note
 * that the `operate` object is unapplied.
 *
 * @param {Object} record
 * @param {Object} update
 */

function applyUpdate(record, update) {
  for (var field in update.replace) {
    record[field] = update.replace[field];
  }for (var field in update.push) {
    var _record$field;

    var value = update.push[field];
    record[field] = record[field] ? record[field].slice() : [];
    if (Array.isArray(value)) (_record$field = record[field]).push.apply(_record$field, _toConsumableArray(value));else record[field].push(value);
  }

  for (var field in update.pull) {
    var value = update.pull[field];
    record[field] = record[field] ? record[field].slice().filter(exclude.bind(null, Array.isArray(value) ? value : [value])) : [];
  }
}

function exclude(values, value) {
  return !(0, _array_proxy.includes)(values, value);
}
module.exports = exports['default'];